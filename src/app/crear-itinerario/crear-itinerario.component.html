<ion-content class="ion-padding">
  <div class="form-container">
    <h2 class="form-title">Nuevo Itinerario</h2>

    <div class="form-group">
      <label style="color: white; font-weight: bold">¿Quiere que este itinerario se añada a su lista?</label>
      <ion-toggle [(ngModel)]="this.itinerario.apareceEnItinerario"></ion-toggle>

      <label style="color: white; font-weight: bold">¿Quiere que este itinerario se añada a sus rutas?</label>
      <ion-toggle [(ngModel)]="this.itinerario.estaEnRuta"></ion-toggle>
    </div>


    <form class="form-content">
      <!-- Selección de viaje -->
      <div class="form-group">
        <label for="viaje" style="color: white; font-weight: bold">Seleccionar viaje:</label>
        <select
          id="viaje"
          name="viaje"
          [(ngModel)]="idViajeSeleccionado"
          (change)="onViajeChange()"
        >
          <option *ngFor="let viaje of viajes" [value]="viaje.id">
            {{ viaje.nombre }}
          </option>
        </select>
      </div>

      <!-- Nombre de actividad -->
      <div class="form-group">
        <label for="actividad" style="color: white; font-weight: bold">Nombre de la actividad:</label>
        <input
          type="text"
          id="actividad"
          name="actividad"
          placeholder="Ej. Museo del Prado"
          [(ngModel)]="itinerario.actividad"
        />
      </div>


      <!-- Foto -->
      <div class="form-group">
        <label for="foto" style="color: white; font-weight: bold">Foto:</label>
        <input
          type="file"
          id="foto"
          name="foto"
          accept="image/*"
          [ngModel] ="itinerario.foto"
        />
      </div>

      <!-- Hora -->
      <div class="form-group">
        <label for="hora" style="color: white; font-weight: bold">Hora a la que ir:</label>
        <input
          type="time"
          id="hora"
          name="hora"
          [(ngModel)]="itinerario.hora"
        />
      </div>

      <!-- Duración -->
      <div class="form-group">
        <label for="duracion" style="color: white; font-weight: bold">Duración:</label>
        <input
          type="text"
          id="duracion"
          name="duracion"
          placeholder="2 horas"
          [(ngModel)]="itinerario.duracion"
        />
      </div>

      <!-- Categoría -->
      <div class="form-group">
        <label for="categoria" style="color: white; font-weight: bold">Categoría:</label>
        <select id="categoria" name="categoria" [(ngModel)]="itinerario.categoria">
          <option *ngFor="let categoria of categoriaItinerario" [value]="categoria " [(ngModel)]="itinerario.categoria">
            {{ categoria }}
          </option>
        </select>
      </div>

      <!-- Ubicación desde el mapa -->
      <div class="form-group">
        <label style="color: white; font-weight: bold">Elige sitio:</label>

        <input id="autocomplete" type="text" placeholder="Buscar lugar..." class="map-search" />

        <div id="map" class="map-container"></div>

        <div style="margin-top: 1rem; color: white">
          Latitud: {{ itinerario.latitud }} <br />
          Longitud: {{ itinerario.longitud }}
        </div>
      </div>




      <!-- Toggle formulario de billete -->
      <div class="form-group">
        <label style="color: white; font-weight: bold">Billete (opcional):</label>
        <ion-button
          fill="outline"
          color="secondary"
          (click)="toggleBilleteForm()"
          style="border-radius: 12px; font-weight: 600;"
        >
          {{ mostrarFormularioBillete ? 'Ocultar Billete' : 'Crear Billete' }}
        </ion-button>
      </div>

      <!-- Formulario de billete -->
      <div
        *ngIf="mostrarFormularioBillete"
        class="form-group subformulario"
        style="margin-top: 1rem;"
      >
        <label style="color: white; font-weight: bold">Nombre del billete:</label>
        <input
          type="text"
          name="nombreBillete"
          [(ngModel)]="billete.nombre"
          placeholder="Ej. Entrada museo..."
        />

        <select
          name="categoriaBillete"
          [(ngModel)]="billete.categoria"
        >
          <option value="">Selecciona una categoría</option>
          <option *ngFor="let opcion of categorias" [value]="opcion">
            {{ opcion }}
          </option>
        </select>

        <label
          style="color: white; margin-top: 0.5rem;"
        >Subir PDF:</label
        >
        <input
          type="file"
          (change)="onPdfSeleccionado($event)"
          name="pdf"
          accept="application/pdf"
        />

        <ion-button (click)="crearBillete()">Crear Billete</ion-button>
      </div>

      <!-- Selección y creación de días -->
      <div class="form-group">
        <label for="dias" style="color: white; font-weight: bold">Días del itinerario:</label>
        <select id="dias" name="dias">
          <option *ngFor="let dia of dias" [value]="dia.id">
            Día {{ dia.numeroDia }} ({{ dia.fecha }})
          </option>
        </select>
        <ion-button
          fill="outline"
          color="secondary"
          (click)="toggleDiaForm()"
          style="margin-left: 10px; border-radius: 12px; font-weight: 600;"
        >
          {{ mostrarFormularioDia ? 'Ocultar Día' : 'Crear Día' }}
        </ion-button>
      </div>

      <!-- Formulario de día -->
      <div
        *ngIf="mostrarFormularioDia"
        class="form-group subformulario"
        style="margin-top: 1rem;"
      >
        <label style="color: white; font-weight: bold">Fecha:</label>
        <input
          type="date"
          name="fecha"
          [(ngModel)]="dia.fecha"
        />

        <label style="color: white; font-weight: bold">Número de Día:</label>
        <input
          type="number"
          name="numeroDia"
          [(ngModel)]="dia.numeroDia"
          placeholder="Ej. 1"
        />

        <ion-button (click)="crearDia()">Crear Día</ion-button>
      </div>

      <!-- Horarios -->
      <label style="color: white; font-weight: bold">Horarios</label>
      <div class="horarios-container">
        <div class="horario-field">
          <label for="horaInicio">Hora de apertura:</label>
          <input
            type="time"
            id="horaInicio"
            name="horaInicio"
            [(ngModel)]="horaInicio"
          />
        </div>

        <div class="horario-field">
          <label for="horaFin">Hora de cierre:</label>
          <input
            type="time"
            id="horaFin"
            name="horaFin"
            [(ngModel)]="horaFin"
          />
        </div>

        <div class="horario-field">
          <label for="cerrado">¿Está cerrado?</label>
          <input
            type="checkbox"
            id="cerrado"
            name="cerrado"
            [(ngModel)]="cerrado"
          />
        </div>

        <div class="add-button-container">
          <ion-button (click)="agregarHorario()">Añadir</ion-button>
        </div>
      </div>

      <ion-textarea
        class="horarioInputFull"
        placeholder="Horarios del sitio:"
        fill="outline"
        readonly
        autoGrow="true"
        name="horarios"
        [(ngModel)]="itinerario.horarios"
      >
      </ion-textarea>

      <!-- Botón de envío -->
      <div class="button-container">
        <ion-button
          expand="full"
          color="primary"
          style="border-radius: 12px; font-weight: 600;"
          (click)="crearItinerario()"
         >
          Crear Itinerario
        </ion-button>
      </div>
    </form>
  </div>
</ion-content>
